<!DOCTYPE html>
<html>

<head>
    <title>demo</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://res.wx.qq.com/open/libs/weui/2.0.1/weui.min.css">
    <link rel="stylesheet" href="./css/example.css">
    <script type="text/javascript" src="https://res.wx.qq.com/t/wx_fed/cdn_libs/res/weui/1.2.3/weui.min.js"></script>
    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <meta name="viewport"
        content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
</head>

<body>
    <!-- <a href="https://github.com/Tencent/weui.js/blob/master/docs/README.md">查看文档</a> -->
    <div class="page__bd">
        <div class="weui-search-bar" id="searchBar">
            <form class="weui-search-bar__form" id="searchForm" action="#">
                <div class="weui-search-bar__box">
                    <i class="weui-icon-search"></i>
                    <input type="search" class="weui-search-bar__input" id="searchQ" placeholder="请输入品牌名" required="">
                    <a href="javascript:" class="weui-icon-clear"></a>
                </div>
                <label class="weui-search-bar__label">
                    <i class="weui-icon-search"></i>
                    <span>请输入品牌名</span>
                </label>
            </form>
            <a href="javascript:" class="weui-search-bar__cancel-btn">取消</a>
        </div>

        <div id="result"></div>
        <!-- <div class="weui-panel weui-panel_access">
            <div class="weui-panel__hd">索爱手机</div>
            <div class="weui-panel__bd">
                <div role="option" class="weui-media-box weui-media-box_text">
                    <strong class="weui-media-box__title">[国旗]日本</strong>
                    <p class="weui-media-box__desc">
                        索尼|爱立信公司
                    </p>
                    <ul class="weui-media-box__info" aria-hidden="true">
                        <li class="weui-media-box__info__meta" aria-hidden="true">手机</li>
                    </ul>
                </div>
            </div>
        </div> -->
        <div id="noresult" class="weui-msg" style="display: none;">
            <div class="weui-msg__icon-area"><i class="weui-icon-warn weui-icon_msg"></i></div>
            <div class="weui-msg__text-area">
                <h2 class="weui-msg__title">未查询到数据</h2>
                <p class="weui-msg__desc" id="noresult-desc"></p>
                <p class="weui-msg__desc">
                    <a href="javascript:" class="weui-btn weui-btn_default" id="addDataBtn"
                        wah-hotarea="click">帮我完善数据</a>
                </p>
            </div>
        </div>
        <div id="thanksAdd" class="weui-msg" style="display: none;">
            <div class="weui-msg__icon-area"><i class="weui-icon-success weui-icon_msg"></i></div>
            <div class="weui-msg__text-area">
                <h2 class="weui-msg__title">反馈成功</h2>
                <p class="weui-msg__desc" id="noresult-desc">
                    感谢您的帮助，数据将会尽快维护进去，谢谢你，因为有你，世界更美丽~~~
                </p>
            </div>
        </div>
    </div>
    <div class="page__ft j_bottom">
        <a href="javascript:" id="giveMeMoney" wah-hotarea="click">赞助一下</a>
    </div>
    <script type="text/javascript">
        weui.searchBar('#searchBar');

        $().ready(function () {

            $('#searchForm').on('submit', function () {
                let q = $('#searchQ').val()
                $('#thanksAdd').hide()
                $.get("/search?q=" + q, function (data) {
                    $('#result').empty()
                    let results = data.result
                    let html = ''
                    results.forEach(element => {
                        html += '<div class="weui-panel weui-panel_access">'
                        html += '<div class="weui-panel__hd">'
                        html += element.brand
                        html += '</div>'
                        html += '<div class="weui-panel__bd">'
                        html += '<div role="option" class="weui-media-box weui-media-box_text">'
                        html += '<strong class="weui-media-box__title">'
                        element.country.forEach(country => {
                            html += country.name + '|'
                        })
                        html = html.substring(0, html.length - 1)
                        html += '</strong>'
                        html += '<p class="weui-media-box__desc">'
                        element.company.forEach(company => {
                            html += company.name + "|"
                        })
                        html = html.substring(0, html.length - 1)
                        html += '</p>'
                        html += '<ul class="weui-media-box__info" aria-hidden="true">'
                        html += '<li class="weui-media-box__info__meta" aria-hidden="true">'
                        element.category.forEach(category => html += category + "|")
                        html = html.substring(0, html.length - 1)
                        html += '</ul></div></div></div>'
                    });
                    if (html === '') {
                        $('#noresult-desc').html('你输入的品牌【<span style="color: RED">' + q + '</span>】查不到数据')
                        $('#noresult').show()
                    } else {
                        $('#noresult').hide()
                        $('#result').html(html)
                    }
                })
            })

            $('#giveMeMoney').on('click', function () {
                let moneyQrcode = 1
                let contentHtml = '<p id="giveMeMondyText">个人开发，服务器真贵，感谢赞助，截图保存，<span style="color: #1890FF">支付宝</span>扫一扫打开本地相册</p><br>'
                contentHtml += '<img id="giveMeMondyQrcode" style="width: 260px; height: 260px" src="./img/zfbskm.png"></img><br>'
                contentHtml += '<a href="javascript:" id="changeMondyQrcode">更换赞助方式</>';

                weui.dialog({
                    title: '赞助一下',
                    content: contentHtml,
                    className: 'give-me-money',
                    buttons: [{
                        label: '确定',
                        type: 'primary',
                        onClick: function () {
                            alert('a')
                        }
                    }]
                });

                $('#changeMondyQrcode').on('click', function () {
                    if (moneyQrcode === 1) {
                        moneyQrcode = 2
                        $('#giveMeMondyQrcode').attr('src', './img/wxskm.png')
                        $('#giveMeMondyText').html('个人开发，服务器真贵，感谢赞助，截图保存，<span style="color: #04BE02">微信</span>扫一扫打开本地相册')
                    } else {
                        moneyQrcode = 1
                        $('#giveMeMondyQrcode').attr('src', './img/zfbskm.png')
                        $('#giveMeMondyText').html('个人开发，服务器真贵，感谢赞助，截图保存，<span style="color: #1890FF">支付宝</span>扫一扫打开本地相册')
                    }
                })
            })

            $('#addDataBtn').on('click', function () {
                let q = $('#searchQ').val()
                weui.dialog({
                    title: '帮我完善数据',
                    content: '是否想要管理员录入名为【<span style="color: RED">' + q + '</span>】的品牌信息？',
                    className: 'add-data',
                    buttons: [{
                        label: '取消',
                        type: 'default',
                        onClick: function () {
                            $('#thanksAdd').hide()
                            $('#searchQ').val('')
                        }
                    }, {
                        label: '确定',
                        type: 'primary',
                        onClick: function () {
                            // todo 上传数据
                            $('#searchQ').val('')
                            $('#noresult').hide()
                            $('#thanksAdd').show()
                        }
                    }]
                });
            })

        });

    </script>
</body>

</html>